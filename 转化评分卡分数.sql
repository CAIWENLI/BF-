select t2.CONTRACT_NO,
(INTERCEPT_SCORE+AMOUNT_X_INITPAY_SCORE+CERTF_EXP_YEAR_SCORE+CERT_4_INITAL_SCORE+CITY_SCORE+GOODS_INFO_SCORE+INCOME_X_AGE_SCORE+INNER_CODE_SCORE
+IS_DD_SCORE+PROD_CODE_SCORE+SEX_X_FAMILYSTATE_SCORE)RAW_SCORE,
EXP(INTERCEPT_SCORE+AMOUNT_X_INITPAY_SCORE+CERTF_EXP_YEAR_SCORE+CERT_4_INITAL_SCORE+CITY_SCORE+GOODS_INFO_SCORE+INCOME_X_AGE_SCORE+INNER_CODE_SCORE
+IS_DD_SCORE+PROD_CODE_SCORE+SEX_X_FAMILYSTATE_SCORE)/(1+EXP(INTERCEPT_SCORE+AMOUNT_X_INITPAY_SCORE+CERTF_EXP_YEAR_SCORE+CERT_4_INITAL_SCORE+CITY_SCORE+GOODS_INFO_SCORE+INCOME_X_AGE_SCORE+INNER_CODE_SCORE
+IS_DD_SCORE+PROD_CODE_SCORE+SEX_X_FAMILYSTATE_SCORE))F_SCORE
from
(
SELECT T1.*,
-6.06138751999629 INTERCEPT_SCORE,
(CASE WHEN AMOUNT_X_INITPAY='1' THEN 1.22294674339412 WHEN AMOUNT_X_INITPAY='2' THEN 0.890040230782934 ELSE 0 END)AMOUNT_X_INITPAY_SCORE,
(CASE WHEN CERTF_EXP_YEAR='1' THEN 0.553477429020283 WHEN CERTF_EXP_YEAR='2' THEN 0.194158186736889
 ELSE 0 END)CERTF_EXP_YEAR_SCORE,
(CASE WHEN CERT_4_INITAL='1' THEN 0.702223425286478 WHEN CERT_4_INITAL='2' THEN 0.336649028876624 ELSE 0 END)CERT_4_INITAL_SCORE,
(CASE WHEN CITY='1' THEN 1.11333327593468 WHEN CITY='2' THEN 0.683125554582076
 WHEN CITY='3' THEN 0.50512243850418 ELSE 0 END)CITY_SCORE,
(CASE WHEN GOODS_INFO='1' THEN 0.856742044209341 WHEN GOODS_INFO='2' THEN 0.423333007188368 ELSE 0 END)GOODS_INFO_SCORE,
(CASE WHEN INCOME_X_AGE='1' THEN 0.184796365482785 WHEN INCOME_X_AGE='2' THEN 0.118994166784802 ELSE 0 END)INCOME_X_AGE_SCORE, 
(CASE WHEN INNER_CODE='1' THEN 0.430716415288872 ELSE 0 END)INNER_CODE_SCORE,
(CASE WHEN IS_DD='1' THEN 0.341464336530717  ELSE 0 END)IS_DD_SCORE,
(CASE WHEN PROD_CODE='1' THEN 0.537536042177285 WHEN PROD_CODE='2' THEN 0.316292709485626 ELSE 0 END)PROD_CODE_SCORE,
(CASE WHEN SEX_X_FAMILYSTATE='1' THEN 1.01786297893591 WHEN SEX_X_FAMILYSTATE='2' THEN 0.670156970240762 ELSE 0 END)SEX_X_FAMILYSTATE_SCORE
from
(
select 
t.CONTRACT_NO,
cu.f_sco_var_level('AMOUNT_X_INITPAY',t.CREDIT_AMOUNT||'$'||t.INIT_PAY) AMOUNT_X_INITPAY,
       
cu.f_sco_var_level('CERT_4_INITAL',T.cert_seq) CERT_4_INITAL,
       
cu.f_sco_var_level('GOODS_INFO',CU.F_GET_GOODS_INFO(T.PRODUCTCATEGORYNAME,T.GOODS_TYPE,T.BRANDTYPE,T.MANUFACTURER,T.PRICE)) GOODS_INFO,
       
cu.f_sco_var_level('INCOME_X_AGE', t1.SelfMonthIncome ||'$'||(case when length(T.cert_seq)=18 then TRUNC(months_between(trunc(T.app_date),to_date(substr(T.cert_seq,7,8),'yyyymmdd'))/12,0)else null end)) INCOME_X_AGE,--直接用个人月收入
     
cu.f_sco_var_level('INNER_CODE',decode(t2.Interiorcode,'2','2','1')) INNER_CODE,--内部代码
       
cu.f_sco_var_level('IS_DD',decode(T2.REPAYMENTWAY,'2','0','1')) IS_DD,--是否代扣
       
cu.f_sco_var_level('PROD_CODE',t.PROD_CODE) PROD_CODE,--产品代码
          
cu.f_sco_var_level('SEX_X_FAMILYSTATE',T1.SEX||'$'||T1.MARRIAGE) SEX_X_FAMILYSTATE,--性别+婚姻状态
       
cu.f_sco_var_level('CERTF_EXP_YEAR',to_char(t.CERTF_EXP,'yyyymmdd')) CERTF_EXP_YEAR,--超过身份证
       
cu.f_sco_var_level('CITY',t3.CITY) CITY

from 
rcas.v_cu_risk_credit_summary t, s1.ind_info_cu t1,s1.business_contract_cu t2,S1.STORE_INFO t3
where  t.ID_PERSON=t1.customerid and t.CONTRACT_NO=t2.serialno and t.POS_CODE=t3.SNO
and T.DATA_SOURCE='AMAR'
and t.LOAN_TYPE='030'                                              --------------消费贷
/*and t.STATUS_en in ('a','c','k','n','y','z','020','040','050','080','090','160','d','x','010') */
and (t.approved = '1' or t.rej = '1')
and t.app_date >= to_date('20151115','yyyymmdd')
and t.app_date <= to_date('20160115','yyyymmdd')
)T1
)T2
